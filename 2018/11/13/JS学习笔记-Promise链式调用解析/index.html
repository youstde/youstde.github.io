<!DOCTYPE html>
<html lang="">
  <head><meta name="generator" content="Hexo 3.8.0">
    
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="JSå­¦ä¹ ç¬”è®°-Promiseé“¾å¼è°ƒç”¨è§£æ">













  <link rel="alternate" href="/atom.xml" title="åšé—»">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=2.10.1">



<link rel="canonical" href="http://yoursite.com/2018/11/13/JSå­¦ä¹ ç¬”è®°-Promiseé“¾å¼è°ƒç”¨è§£æ/">



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css">




  <link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css">



<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.10.1">



  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>









<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":true};
</script>

    <title> JSå­¦ä¹ ç¬”è®°-Promiseé“¾å¼è°ƒç”¨è§£æ - åšé—» </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">åšé—»</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            é¦–é¡µ
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            å½’æ¡£
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">åšé—»</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              é¦–é¡µ
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              å½’æ¡£
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          JSå­¦ä¹ ç¬”è®°-Promiseé“¾å¼è°ƒç”¨è§£æ
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2018-11-13
        </span>
        
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Promiseé“¾å¼è°ƒç”¨è§£æ"><span class="toc-text">Promiseé“¾å¼è°ƒç”¨è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#åè®°ï¼š"><span class="toc-text">åè®°ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æ€»ç»“ï¼š"><span class="toc-text">æ€»ç»“ï¼š</span></a></li></ol></li></ol>
    </div>
  </div>



    <div class="post-content">
      
        <h2 id="Promiseé“¾å¼è°ƒç”¨è§£æ"><a href="#Promiseé“¾å¼è°ƒç”¨è§£æ" class="headerlink" title="Promiseé“¾å¼è°ƒç”¨è§£æ"></a>Promiseé“¾å¼è°ƒç”¨è§£æ</h2><p>å…³äºPromiseæ˜¯åšä»€ä¹ˆçš„æˆ‘å°±ä¸èµ˜è¿°äº†ï¼Œå½“ä½ çœ‹åˆ°è¿™ä¸ªæ–‡ç« çš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿå°±é»˜è®¤ä½ æ˜¯ç”¨è¿‡Promiseçš„</p>
<p>é¦–å…ˆï¼Œä¸¾ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–ç”¨æˆ·id</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserId</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        resolve(<span class="number">186</span>)</span><br><span class="line">      &#125;, <span class="number">1e3</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€šè¿‡ç”¨æˆ·idè·å–è¯¥ç”¨æˆ·çš„æ‰‹æœºå·</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getMobileByUserId</span>(<span class="params">userId</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            resolve(userId + <span class="string">'****5836'</span>)</span><br><span class="line">        &#125;, <span class="number">1e3</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸¤ä¸ªæ–¹æ³•ï¼ŒgetUserId(ç®€ç§°<strong>IDfun</strong>)å’ŒgetMobileByUserId(ç®€ç§°<strong>MOfun</strong>),ä¸¤è€…éƒ½æ˜¯returnäº†ä¸€ä¸ªPromiseå®ä¾‹ï¼Œå‰è€…æ˜¯è·å–ç”¨æˆ·idï¼Œåè€…æ˜¯æ‹¿ç€ç”¨æˆ·idå»æ¢å–æ‰‹æœºå·ï¼ŒMOfunçš„è¾“å‡ºæ˜¯ä¾èµ–äºIDfunçš„è¾“å‡ºï¼Œè¿™æ ·ä¸¤ä¸ªå¼‚æ­¥çš„æ“ä½œåˆå¾—ä¿è¯å…¶æ˜¯æœ‰åºçš„æ‰§è¡Œ</p>
<p>åˆ°è¿™ï¼Œåº”è¯¥éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„è§£å†³åŠæ³•ï¼Œæˆ‘è¿™é‡Œåˆ—ä¸¾äº†ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IDfun()</span><br><span class="line">    .then(MOfun)</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    	<span class="built_in">console</span>.log(res)</span><br><span class="line">	&#125;)</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼Œè°ƒç”¨äº†IDfunï¼Œåœ¨å…¶Promiseå®ä¾‹çš„thenæ–¹æ³•ä¸­ä¼ å…¥MOfunï¼Œç´§éšå…¶ååˆæ˜¯ä¸€ä¸ªthenæ–¹æ³•ï¼Œé‡Œé¢ä¼ å…¥äº†ä¸€ä¸ªcallbackå‡½æ•°ï¼Œæ­¤æ—¶ï¼Œcallbackå‡½æ•°ä¸­æ‰“å°çš„å€¼æ˜¯ä»€ä¹ˆï¼Œåˆæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Œä¸€èˆ¬æƒ…å†µä¸‹thenæ–¹æ³•é‡Œä¼ çš„éƒ½æ˜¯ä¸€ä¸ªcallbackï¼Œè€Œè¿™ä¸ªä¾‹å­é‡Œä¼ çš„å´æ˜¯ä¸€ä¸ªåŒ…å«Promiseçš„å‡½æ•°ï¼Œå®ƒå†…éƒ¨æ˜¯æ€ä¹ˆåšåˆ°å°†ç”¨æˆ·çš„idä¼ é€’ç»™MOfunä¸­å¹¶æ‰“å°å‡ºæ¥</p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥æœ‰å¦å¤–çš„å†™æ³•</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¾‹2</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserId</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">        resolve(getUserMobileById(<span class="number">9876</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">getUserId().then(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å…¶å®ä¸¤ç§å†™æ³•åŸç†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å†™çš„ä½ç½®ä¸åŒè€Œå·²ï¼Œä»Šå¤©è¦è¯´çš„æ˜¯ç¬¬ä¸€ç§å†™æ³•ã€‚</p>
<p>è¯´åˆ°è¿™ï¼Œæˆ‘å…ˆåˆ—ä¸¾å‡ ä¸ªPromiseä¸­å‡ ä¸ªæ¯”è¾ƒæ ¸å¿ƒçš„æ–¹æ³•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// thisæŒ‡å‘æ˜¯Promiseå®ä¾‹</span></span><br><span class="line"><span class="comment">// åªåˆ—ä¸¾äº†å‡ ä¸ªå…³é”®çš„ä»£ç </span></span><br><span class="line"><span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">        handle(&#123;</span><br><span class="line">            onFulfilled: onFulfilled || <span class="literal">null</span>,</span><br><span class="line">            resolve: resolve</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">deferred</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (state === <span class="string">'pending'</span>) &#123;</span><br><span class="line">        deferreds.push(deferred);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ret = deferred.onFulfilled(value);</span><br><span class="line">    deferred.resolve(ret);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å…¶ä¸­çš„stateå’Œvalueå¯ä»¥ç†è§£ä¸ºå…¨å±€å®šä¹‰çš„ï¼Œåªæ˜¯æ”¾äº†ä¸€äº›ä»£ç æ®µå‡ºæ¥</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (newValue &amp;&amp; (<span class="keyword">typeof</span> newValue === <span class="string">'object'</span> || <span class="keyword">typeof</span> newValue === <span class="string">'function'</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> then = newValue.then;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</span><br><span class="line">            then.call(newValue, resolve);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    state = <span class="string">'fulfilled'</span>;</span><br><span class="line">    value = newValue;     <span class="comment">// valueè¿™é‡Œå¯ä»¥ç†è§£ä¸ºå®ƒæ˜¯åœ¨å…¨å±€å®šä¹‰çš„</span></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        deferreds.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">deferred</span>) </span>&#123;</span><br><span class="line">            handle(deferred);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‚ç…§è¿™å‡ ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å†å›åˆ°åˆšæ‰é‚£ä¸ªä¾‹å­ï¼š</p>
<ul>
<li>1.æ‰§è¡ŒIDfunè¿”å›ä¸€ä¸ªPromiseå®ä¾‹ï¼ˆ<strong>IDPro</strong> ï¼‰ï¼Œæ‰§è¡ŒIDProä¸­çš„ä»£ç ï¼Œå‡è®¾æ­¤æ—¶åœ¨å¼‚æ­¥å‘é€è¯·æ±‚ï¼Œç»§ç»­æ‰§è¡Œthenæ–¹æ³•ï¼Œthenæ–¹æ³•ä¸­ä¼ å…¥äº†MOfun</li>
<li>2.è¿›å…¥åˆ°thenæ–¹æ³•ä¸­ï¼Œä¹Ÿæ˜¯è¿”å›ä¸€ä¸ªPromiseå®ä¾‹ï¼ˆ<strong>BridgePro1</strong>ï¼‰,è°ƒç”¨handleæ–¹æ³•</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">handle(&#123;</span><br><span class="line">    onFulfilled: onFulfilled || <span class="literal">null</span>,  <span class="comment">// æ­¤æ—¶çš„onFulfilled === MOfun</span></span><br><span class="line">    resolve: resolve  <span class="comment">// resolveæ˜¯BridgePro1çš„resolve</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>3.è¿›å…¥handleä¸­ï¼Œå¦‚æœæ˜¯IDProçš„thenæ–¹æ³•å…ˆæ‰§è¡Œï¼Œå…¶resolveåæ‰§è¡Œï¼Œè¿™ä¸ªæ—¶å€™ <code>state</code> === <code>pending</code>,æ­¤æ—¶å®ƒä¼šå°†ä¼ å…¥çš„å¯¹è±¡pushåˆ°IDProçš„deferredsæ•°ç»„ä¸­ï¼Œç„¶åè¿”å›</li>
<li>4.IDProä¸­å¼‚æ­¥æ“ä½œå®Œæˆï¼Œæ‰§è¡Œå…¶resolveï¼Œå¹¶ä¼ å…¥idä¸º186</li>
<li>5.è¿›å…¥resolveæ–¹æ³•ä¸­ï¼Œæ­¤æ—¶newValueä¸æ»¡è¶³ifæ¡ä»¶ï¼Œè·³è¿‡ï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œæ”¹å˜<code>state</code>===&gt; <code>fulfilled</code>,<code>value</code> ===&gt; <code>186</code>,setTimeoutä¸º0æ˜¯ä¸ºäº†æŠŠå…¶å†…éƒ¨çš„è¿™æ®µä»£ç æ”¾åˆ°é˜Ÿåˆ—çš„æœ€åï¼Œä¿è¯æ‰§è¡Œè¿™æ®µä»£ç çš„æ—¶å€™thenæ–¹æ³•å·²ç»æ‰§è¡Œäº†,å¾ªç¯éå†IDProçš„deferredsæ•°ç»„ï¼Œå°†æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹ä¼ å…¥handleä¸­å¹¶æ‰§è¡Œ</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">newValue</span>) </span>&#123;   <span class="comment">// newValue === 186</span></span><br><span class="line">    <span class="keyword">if</span> (newValue &amp;&amp; (<span class="keyword">typeof</span> newValue === <span class="string">'object'</span> || <span class="keyword">typeof</span> newValue === <span class="string">'function'</span>)) &#123;</span><br><span class="line">        <span class="keyword">var</span> then = newValue.then;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</span><br><span class="line">            then.call(newValue, resolve);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    state = <span class="string">'fulfilled'</span>;</span><br><span class="line">    value = newValue;     <span class="comment">// valueè¿™é‡Œå¯ä»¥ç†è§£ä¸ºå®ƒæ˜¯åœ¨å…¨å±€å®šä¹‰çš„</span></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// deferredsé‡Œå­˜æ”¾çš„æ˜¯é€šè¿‡thenä¼ å…¥çš„</span></span><br><span class="line">        <span class="comment">// [&#123;</span></span><br><span class="line">        <span class="comment">//    onFulfilled: MOfun,</span></span><br><span class="line">        <span class="comment">//    resolve: resolve</span></span><br><span class="line">        <span class="comment">// &#125;]</span></span><br><span class="line">        deferreds.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">deferred</span>) </span>&#123;  </span><br><span class="line">            handle(deferred);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>6.è¿›å…¥handleä¸­ï¼Œæ­¤æ—¶state === fulfilledï¼Œæ‰§è¡Œdeferredä¸­çš„onFulfilledï¼ˆMOfunï¼‰,ä¼ å…¥value,è¿”å›ä¸€ä¸ªPromiseå®ä¾‹ï¼ˆ<strong>MOPro</strong>ï¼‰,æ­¤æ—¶çš„ret === MOProï¼Œç»§ç»­æ‰§è¡Œdeferredä¸­çš„resolveï¼ˆBridgePro1çš„resolveï¼‰ï¼Œä¼ å…¥ret</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// state === fulfilled</span></span><br><span class="line"><span class="comment">// deferred ===&gt; </span></span><br><span class="line"><span class="comment">//  &#123;</span></span><br><span class="line"><span class="comment">//    onFulfilled: MOfun,</span></span><br><span class="line"><span class="comment">//    resolve: resolve</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">deferred</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (state === <span class="string">'pending'</span>) &#123;</span><br><span class="line">        deferreds.push(deferred);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ret = deferred.onFulfilled(value);  <span class="comment">// value === 186</span></span><br><span class="line">    deferred.resolve(ret);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>7.è¿›å…¥resolveä¸­,æ­¤æ—¶newValueæ»¡è¶³åˆ¤æ–­æ¡ä»¶</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">newValue</span>) </span>&#123;   <span class="comment">// newValue === MOPro</span></span><br><span class="line">    <span class="keyword">if</span> (newValue &amp;&amp; (<span class="keyword">typeof</span> newValue === <span class="string">'object'</span> || <span class="keyword">typeof</span> newValue === <span class="string">'function'</span>)) &#123;</span><br><span class="line">        <span class="comment">// then æ˜¯MOProçš„then</span></span><br><span class="line">        <span class="keyword">var</span> then = newValue.then;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</span><br><span class="line">            <span class="comment">// è°ƒç”¨thenæ–¹æ³•ï¼Œè®¾ç½®å…¶å†…éƒ¨thisæŒ‡å‘ä¸ºMOProï¼Œå¹¶ä¼ å…¥resolveï¼Œè¿™ä¸ªresolveä¸ºBridgePro1çš„resolveï¼Œç„¶åè¿”å›</span></span><br><span class="line">            then.call(newValue, resolve);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    state = <span class="string">'fulfilled'</span>;</span><br><span class="line">    value = newValue;     </span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        deferreds.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">deferred</span>) </span>&#123;  </span><br><span class="line">            handle(deferred);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>8.è¿›å…¥åˆ°MOProçš„thenæ–¹æ³•ä¸­ï¼Œè°ƒç”¨handleå°†å¯¹è±¡ä¼ å…¥ï¼Œæ­¤æ—¶MOProçš„deferredsæ•°ç»„ä¸­æœ‰ä¸¤é¡¹ï¼Œä¸€é¡¹æ˜¯ä¸Šé¢é€šè¿‡resolveä¼ å…¥çš„ï¼Œå¦ä¸€é¡¹æ˜¯ä¼ å…¥çš„callbackå‡½æ•°</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ===&gt; callback</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// onFulfilledä¸ºBridgePro1çš„resolve </span></span><br><span class="line">    <span class="comment">// æ­¤æ—¶è¿”å›çš„Promiseå®ä¾‹ä¸ºBridgePro2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">        handle(&#123;</span><br><span class="line">            onFulfilled: onFulfilled || <span class="literal">null</span>,</span><br><span class="line">            resolve: resolve  <span class="comment">// BridgePro2</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>9.å½“MOProä¸­å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œæˆï¼Œæ‰§è¡Œresolveå¹¶ä¼ å…¥æ‰‹æœºå·<code>1865836</code>ï¼Œè¿›å…¥resolve,å°†stateè®¾ç½®ä¸ºfulfilledï¼Œvalueè®¾ç½®æˆ<code>1865836</code>ï¼Œå»¶è¿Ÿå¾ªç¯MOProçš„deferredsæ•°ç»„ï¼Œæ­¤æ—¶æ•°ç»„ä¸ºï¼š</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        onFulfilled: resolve,   <span class="comment">// BridgePro1çš„resolve</span></span><br><span class="line">        resolve: resolve  <span class="comment">// BridgePro2çš„resolve</span></span><br><span class="line">    &#125;ï¼Œ</span><br><span class="line">    &#123;</span><br><span class="line">     	onFulfilled: callback,</span><br><span class="line">        resolve: resolve  <span class="comment">// BridgePro3çš„resolve</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<ul>
<li>10.è¿›å…¥handleæ–¹æ³•ä¸­,å¾ªç¯ç¬¬ä¸€ä¸ªå€¼æ—¶ï¼Œæ­¤æ—¶deferredçš„onFulfilledä¸ºBridgePro1çš„resolveï¼Œè°ƒç”¨è¯¥resolveï¼Œå¹¶ä¼ å…¥valueï¼ˆ<code>1865836</code>ï¼‰,å› ä¸ºBridgePro1çš„deferredsä¸ºç©ºï¼Œæ‰€ä»¥ç›´æ¥resolveæ‰BridgePro1ï¼Œæ­¤æ—¶retä¸ºundefinedï¼Œå†æ‰§è¡Œdeferredçš„resolveï¼ˆBridgePro2çš„resolveï¼‰ï¼ŒåŒæ ·ï¼Œresolveæ‰BridgePro2ï¼Œç»§ç»­å¾ªç¯ï¼Œä¼ å…¥ç¬¬äºŒä¸ªå€¼ï¼Œdeferredçš„onFulfilledä¸ºcallbackï¼Œæ‰§è¡Œcallbackä¼ å…¥valueï¼Œæ‰“å°å‡ºæ‰‹æœºå·<code>1865836</code>,è¿”å›å€¼ä¸ºundefined ,å› æ­¤retä¸ºundefinedï¼Œå†æ‰§è¡Œdeferredçš„resolveï¼ˆBridgePro3çš„resolveï¼‰ï¼Œç›´æ¥resolveæ‰BridgePro3</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">deferred</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (state === <span class="string">'pending'</span>) &#123;</span><br><span class="line">        deferreds.push(deferred);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ret = deferred.onFulfilled(value);</span><br><span class="line">    deferred.resolve(ret);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>11.è‡³æ­¤ï¼Œæ‰§è¡Œå®Œæˆï¼Œé€šè¿‡userçš„idæ¢å–äº†userçš„mobile number</li>
</ul>
<h4 id="åè®°ï¼š"><a href="#åè®°ï¼š" class="headerlink" title="åè®°ï¼š"></a>åè®°ï¼š</h4><p>å¦‚æœæˆ‘æƒ³æŒ‰ç…§ä¸‹é¢çš„å†™æ³•ä¸€ç›´thenä¸‹å»ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IDfun()</span><br><span class="line">    .then(MOfun)</span><br><span class="line">    .then(callback)</span><br><span class="line">	.then(callback)</span><br><span class="line">	.then(callback)</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ªcallbacké‡Œéƒ½å¯ä»¥æ‰“å°åˆ°æ‰‹æœºå·ï¼Œåº”è¯¥æ€ä¹ˆå†™</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// callback</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// doing something</span></span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h4><p>Promiseæ˜¯ä»€ä¹ˆï¼Œä»å­—é¢æ„æ€å°±æ˜¯ä¸€ä¸ªæ‰¿è¯ºï¼Œæˆ‘ç»™ä½ äº†ä¸€ä¸ªæ‰¿è¯ºï¼Œä½ è®°ç€å‘¢ï¼Œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™å…‘ç°ï¼Œä½†è‚¯å®šä¼šç»™ä½ ä¸€ä¸ªç­”å¤ï¼Œæ‰“ä¸€ä¸ªä¸å¤ªå½¢è±¡çš„æ¯”å–»ï¼Œæˆ‘å»é“¶è¡ŒåŠäº‹ï¼Œè‚¯å®šæ˜¯å…ˆå–ä¸€ä¸ªå·ï¼Œè¿™ä¸ªå·å°±åƒä¸€ä¸ªæ‰¿è¯ºï¼Œä»€ä¹ˆæ—¶å€™å«åˆ°ä½ ï¼Œä¸ç¡®å®šï¼Œä½†è‚¯å®šä¼šå«ä½ ï¼Œç„¶åè¿™ä¸ªæ—¶å€™ä½ å°±ä¼šå»åŠç†ä½ çš„äº‹æƒ…</p>
<p>æœ€åé™„ä¸Šä¸€ä¸ªæµç¨‹å›¾ï¼ˆå›¾ç‰‡æ¥æºäºç¾å›¢ï¼‰ï¼š</p>
<p><img src="http://ww1.sinaimg.cn/large/005QDhBjly1fx6ewjrnfhj30j90cdwfk.jpg" alt=""></p>

      
    </div>

    
      
      



      
      
    

    
      <footer class="post-footer">
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2019/01/11/CSSå­¦ä¹ ç¬”è®°-å®ç°æ»šåŠ¨è¿›åº¦æ¡æ•ˆæœ/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">CSSå­¦ä¹ ç¬”è®°-å®ç°æ»šåŠ¨è¿›åº¦æ¡æ•ˆæœ</span>
        <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
      </a>
    
    
      <a class="next" href="/2018/10/24/JSå­¦ä¹ ç¬”è®°-è¿ç­‰èµ‹å€¼/">
        <span class="next-text nav-default">JSå­¦ä¹ ç¬”è®°-è¿ç­‰èµ‹å€¼</span>
        <span class="prev-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>


      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:songtao_st08@163.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/youstde" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>



<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://hexo.io/">Hexo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2019

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">songtao</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  

  



    
  



  
  





  
    <script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

  
    <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.10.1"></script>

  </body>
</html>
